function [y1] = JasonU10_ANN_TC(x1)
%
% Wind Speed (U10) estimates inside tropical cyclone environment
% JasonU10_ANN_TC.m
% Created by Syarawi Sharoni 4/11/2020
%
% This matlab scipt is to estimates U10 for Jason altimeter inside tropical cyclone environment
% Output, [y1] = Jason U10 wind speed.
% The input file in matrix form.
% Input, x1 = N x 9 matrix input parameters as listed below
% Column 1 = Ku-band backscatter
% Column 2 = C-band backscatter
% Column 3 = Ku-band SWH
% Column 4 = C-band SWH
% Column 5 = Brightness Temperature 18.7 GHz
% Column 6 = Brightness Temperature 23.8 GHz
% Column 7 = Brightness Temperature 34.0 GHz
% Column 8 = Liquid Water Content (LWC)
% Column 9 = Water Vapor Content (WVC)
%
% Detail paper discussed this model is "Tropical cyclone wind speed estimation from the satellite altimeter derived ocean parameters - Syarawi Sharoni,2020"
% Please cite the above paper. TQ. 
%
%% script start here
%
% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [5.34;11.08;0;0;128.03;141.29;151.82;0;5];
x1_step1.gain = [0.1085776330076;0.144927536231884;0.0854883522120111;0.130650640188137;0.0140321335859117;0.0147874306839187;0.0162337662337662;0.632911392405063;0.0183654729109275];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.0398466752055963713;-0.34968352989306733525;-1.7542667457413660959;-1.1593210612361397605;0.47921792311403538234;2.9982464658949909975;-0.87704816380392769393;-2.2451504948030844844;-1.5393403621378969337;0.20662514632556017169;-4.0189922995625781965;1.9520160212088177865;-1.00648260627652264;1.9393764486294111649;2.9081506543086059757];
IW1_1 = [-0.16316903670114227265 -0.021148380056298578256 -0.14242892966035161639 0.68092472617504207211 -2.8164234691711600433 0.24557012297974212256 2.015889175574919534 -1.5014774595103701493 -0.31571519981046886061;0.060325173876945858975 -0.89008676882576609479 0.082681744178518992716 -0.62413867747401174935 2.5141974244411504635 1.0943253814831324089 -1.0821436941942530474 0.67360825615411001888 -1.1998170850557388079;0.086550342234553365173 -1.9432105982788949738 -0.13165138704397008618 0.36656674714343123744 1.0537484307883928647 -0.96029650485860951203 -1.6101408523475464474 0.4794227679421008137 0.061379730130955739709;0.01799918492214953869 -1.6340224776651675054 -0.05587529845230584935 -0.11517284393747836968 1.4644127848692305438 1.6963932766703921917 -0.72154759929079492764 0.19969798646739861381 -1.5661435904695220067;-0.1842803225893634711 -0.19235308082915322792 0.80215707416928927476 0.38646311011188866358 -0.21773588357825535144 0.51426104615462386871 -1.0490436373413856153 0.91948595483709261167 1.0225373836377924519;-0.21462586207962475182 -1.4864249859250107111 1.8004378813928869629 0.77905523367879081498 -0.19875182958123285837 -0.23142390660196934804 -1.0225962252090885496 1.6302214045625653682 0.96543042762998509954;0.31252202915446614107 1.2663337731729700231 -0.14648668407438888983 -0.22924245986318145252 -2.1329456568350853019 1.5339294105680072455 1.7541971508642906219 -0.99909678366057452781 -0.028457631758182937165;2.6071695031469248605 -4.1554542422510651889 -0.30177235713467281952 0.20755446660209625476 -1.6677166425878753309 1.009294342483376461 -3.6537172453926021198 2.4448683614818911281 1.0146396417177683258;0.086481956959579622812 -0.92317565743159102354 -0.95237085259498588385 -0.087604574654486302987 0.18572240700061676266 -0.48512581713029295782 1.9426573896859768986 -1.7554646199360057768 -1.9481232260213343643;0.29994648416652736067 2.1716217513856053145 0.4515691090457009671 0.75339659900398248116 1.3677601310668829893 -0.22147515335667211644 0.33428828479571115473 -1.3831790943195150234 -1.4062962949080997088;0.44518672387147140146 -4.5594476935315695343 3.2902718472451333298 0.95826655884715994382 -1.7406593022304168716 1.3903121778765270555 0.75006700222029021319 -2.9702404004703737428 -0.68462264304480369148;-1.8583063654209424076 3.0882818912283265256 0.20514603745439619065 -0.23885048096899977321 0.8431872185469818648 -0.42135767231865473015 2.9351766227816815658 -1.8452380377909143316 -0.63279202586487637294;0.068321388956854647856 -1.0424286421670470038 0.21972536200783887583 0.075892960152579569399 -0.65631336526573369472 1.3336608428832730233 0.35197386308609823757 -0.11488967549064434126 -0.17011870997833991592;0.67835440630679078033 -2.0537438652790909188 0.23737934091963039385 -0.43727331133225583182 -1.8195725031681249106 -0.68235149557629493078 0.020400696884854942204 2.4461794980502999941 3.097297002334562066;0.19560810736601272342 0.49432397350240314671 0.094817013352131718218 -0.24151196622866877295 2.9062679870405561111 1.4420481725810696538 -1.9519851057831623109 0.70645866443920724009 -0.84454202091401753272];

% Layer 2
b2 = -1.5585916821400949139;
LW2_1 = [1.3663046460646062208 1.896811144079683098 2.8119190524331623138 -2.2231472142403463366 -2.2905035954166930168 -0.83619307778683771293 -1.8299392445083177972 1.4449984000123503591 -1.1688230526539900023 0.82890012518508582318 -0.14414069776695745406 3.3552777068536436822 3.1192541208272310804 1.112027998434094167 2.0492689486185464709];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0692760651195012;
y1_step1.xoffset = 0.2;

% ===== SIMULATION ========

% Dimensions
Q = size(x1,1); % samples

% Input 1
x1 = x1';
xp1 = mapminmax_apply(x1,x1_step1);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = repmat(b2,1,Q) + LW2_1*a1;

% Output 1
y1 = mapminmax_reverse(a2,y1_step1);
y1 = y1';
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
